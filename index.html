<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Konfirmasi Data Ijazah</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #e0f7fa, #fff);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 700px;
      width: 100%;
      background: white;
      margin: 40px 20px;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .logo {
      width: 80px;
      display: block;
      margin: 0 auto 15px;
    }
    h1 {
      text-align: center;
      color: #00796B;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: 600;
    }
    input[type="text"], textarea, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      background-color: #00796B;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #004D40;
    }
    .status {
      margin-top: 10px;
      font-weight: bold;
      color: #d32f2f;
      text-align: center;
    }
    .hidden {
      display: none;
    }
    .form-section {
      margin-top: 20px;
      border-top: 1px solid #eee;
      padding-top: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/84/Lambang_Kemdikbud.png/600px-Lambang_Kemdikbud.png" alt="Logo Sekolah" class="logo">
    <h1>Konfirmasi Data Ijazah</h1>

    <label for="nisn">Masukkan NISN:</label>
    <input type="text" id="nisn" placeholder="Contoh: 1234567890">
    <button onclick="cariData()">Cari Data</button>
    <div class="status" id="status"></div>

    <div id="dataSiswa" class="form-section hidden">
      <h3>Data Anda:</h3>
      <div id="infoSiswa"></div>

      <h4>Apakah data ini sudah benar?</h4>
      <button onclick="tandaiBenar()">✅ Sudah Benar</button>

      <h4>Perlu Koreksi:</h4>
      <label><input type="checkbox" class="chk" value="NAMA" onchange="toggleInput(this)"> Nama</label>
      <label><input type="checkbox" class="chk" value="TEMPAT_LAHIR" onchange="toggleInput(this)"> Tempat Lahir</label>
      <label><input type="checkbox" class="chk" value="TANGGAL_LAHIR" onchange="toggleInput(this)"> Tanggal Lahir</label>
      <label><input type="checkbox" class="chk" value="NAMA_AYAH" onchange="toggleInput(this)"> Nama Ayah</label>
      <label><input type="checkbox" class="chk" value="NAMA_IBU" onchange="toggleInput(this)"> Nama Ibu</label>

      <div id="formPerbaikan" class="hidden form-section"></div>

      <label for="catatan">Catatan Tambahan:</label>
      <textarea id="catatan" rows="3" placeholder="Tulis keterangan jika perlu..."></textarea>
      <button onclick="kirimKoreksi()">Kirim Koreksi</button>
    </div>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxxyO4i8AxZJJ2bzIOR1jUYxtnsSZ6yvKDABZnlqVjekxkxuVbTpf5rmLMHkCoXs8pg/exec'; // ganti dengan URL Web Apps kamu
    let dataSiswa = {};

    function cariData() {
      const nisn = document.getElementById('nisn').value.trim();
      const status = document.getElementById('status');
      status.style.color = "black";
      status.textContent = "⏳ Memuat data...";

      if (!nisn) {
        status.style.color = "red";
        status.textContent = "❌ Silakan masukkan NISN.";
        return;
      }

      fetch(`${scriptURL}?nisn=${nisn}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            status.style.color = "red";
            status.textContent = "❌ Data tidak ditemukan.";
            return;
          }
          dataSiswa = data;
          document.getElementById('infoSiswa').innerHTML = `
            <p><strong>Nama:</strong> ${data.NAMA}</p>
            <p><strong>Tempat Lahir:</strong> ${data.TEMPAT_LAHIR}</p>
            <p><strong>Tanggal Lahir:</strong> ${data.TANGGAL_LAHIR}</p>
            <p><strong>Nama Ayah:</strong> ${data.NAMA_AYAH}</p>
            <p><strong>Nama Ibu:</strong> ${data.NAMA_IBU}</p>
          `;
          document.getElementById('dataSiswa').classList.remove('hidden');
          status.textContent = "";
        })
        .catch(() => {
          status.style.color = "red";
          status.textContent = "❌ Terjadi kesalahan.";
        });
    }

    function toggleInput(checkbox) {
      const formDiv = document.getElementById('formPerbaikan');
      if (checkbox.checked) {
        formDiv.classList.remove('hidden');
        const label = checkbox.nextSibling.textContent.trim();
        const input = document.createElement('input');
        input.type = "text";
        input.id = "input_" + checkbox.value;
        input.placeholder = `Perbaikan ${label}`;
        input.className = 'perbaikanInput';
        input.setAttribute('data-field', checkbox.value);
        formDiv.appendChild(input);
      } else {
        const input = document.querySelector(`#input_${checkbox.value}`);
        if (input) input.remove();
        if (formDiv.children.length === 0) {
          formDiv.classList.add('hidden');
        }
      }
    }

    function tandaiBenar() {
      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify({
          nisn: dataSiswa.NISN,
          nama: dataSiswa.NAMA,
        }),
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(res => res.text())
        .then(msg => {
          alert(msg);
        });
    }

    function kirimKoreksi() {
      const koreksi = {};
      const inputs = document.querySelectorAll('.perbaikanInput');
      inputs.forEach(input => {
        koreksi[input.dataset.field] = input.value;
      });

      fetch(scriptURL, {
        method: 'POST',
        body: JSON.stringify({
          nisn: dataSiswa.NISN,
          nama: dataSiswa.NAMA,
          perbaikan: koreksi,
          catatan: document.getElementById('catatan').value
        }),
        headers: {
          'Content-Type': 'application/json'
        }
      }).then(res => res.text())
        .then(msg => {
          alert(msg);
        });
    }
  </script>
</body>
</html>
