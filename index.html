<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Koreksi Data Siswa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f3f4f6;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    h1 {
      color: #2563eb;
      text-align: center;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    button {
      background-color: #2563eb;
      color: white;
      padding: 10px 16px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background-color: #1d4ed8;
    }
    .field-section {
      margin-top: 20px;
    }
    .checkbox-label {
      display: block;
      margin: 5px 0;
    }
    .hidden {
      display: none;
    }
    .info-box {
      background: #eef2ff;
      padding: 15px;
      margin: 20px 0;
      border-left: 5px solid #6366f1;
    }
    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 0.9em;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Koreksi Data Siswa</h1>
    <input type="text" id="nisn" placeholder="Masukkan NISN">
    <button onclick="cariData()">Cari Data</button>

    <div id="info" class="info-box hidden">Memuat data...</div>

    <div id="data-siswa" class="hidden">
      <div id="hasil-data"></div>
      <button onclick="tampilkanFormKoreksi()">Ajukan Koreksi</button>
      <button onclick="dataBenar()">Data Sudah Benar</button>
    </div>

    <div id="form-koreksi" class="hidden field-section">
      <h3>Form Koreksi</h3>
      <label class="checkbox-label"><input type="checkbox" onchange="toggleInput('NISN')"> Perbaiki NISN</label>
      <input type="text" id="input-NISN" class="hidden" placeholder="NISN baru">

      <label class="checkbox-label"><input type="checkbox" onchange="toggleInput('NIS')"> Perbaiki NIS</label>
      <input type="text" id="input-NIS" class="hidden" placeholder="NIS baru">

      <label class="checkbox-label"><input type="checkbox" onchange="toggleInput('NAMA')"> Perbaiki Nama</label>
      <input type="text" id="input-NAMA" class="hidden" placeholder="Nama baru">

      <label class="checkbox-label"><input type="checkbox" onchange="toggleInput('TEMPAT_LAHIR')"> Perbaiki Tempat Lahir</label>
      <input type="text" id="input-TEMPAT_LAHIR" class="hidden" placeholder="Tempat lahir baru">

      <label class="checkbox-label"><input type="checkbox" onchange="toggleInput('TANGGAL_LAHIR')"> Perbaiki Tanggal Lahir</label>
      <input type="text" id="input-TANGGAL_LAHIR" class="hidden" placeholder="Tanggal lahir baru (yyyy-mm-dd)">

      <label class="checkbox-label"><input type="checkbox" onchange="toggleInput('NAMA_AYAH')"> Perbaiki Nama Ayah</label>
      <input type="text" id="input-NAMA_AYAH" class="hidden" placeholder="Nama ayah baru">

      <label class="checkbox-label"><input type="checkbox" onchange="toggleInput('NAMA_IBU')"> Perbaiki Nama Ibu</label>
      <input type="text" id="input-NAMA_IBU" class="hidden" placeholder="Nama ibu baru">

      <label for="catatan">Catatan Tambahan:</label>
      <textarea id="catatan" placeholder="Tambahkan catatan jika perlu..."></textarea>

      <button onclick="kirimKoreksi()">Kirim Koreksi</button>
    </div>

    <div class="footer">Â© 2025 | SMP Anda</div>
  </div>

  <script>
    let dataSiswa = null;

    function cariData() {
      const nisn = document.getElementById("nisn").value.trim();
      if (!nisn) return alert("Masukkan NISN terlebih dahulu.");

      document.getElementById("info").classList.remove("hidden");
      document.getElementById("info").innerText = "Memuat data...";

      fetch(`https://script.google.com/macros/s/AKfycbwI0QPppH0PcKsAH_VO0KpuANdp8xsWftjcd1LEReTTb-mE3xMYTS0TsV_LGt1Oh37R/exec?nisn=${nisn}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) {
            document.getElementById("info").innerText = "NISN tidak ditemukan.";
            document.getElementById("data-siswa").classList.add("hidden");
            dataSiswa = null;
          } else {
            document.getElementById("info").classList.add("hidden");
            dataSiswa = data;
            document.getElementById("data-siswa").classList.remove("hidden");

            let hasil = "";
            for (let key in data) {
              hasil += `<strong>${key}</strong>: ${data[key]}<br>`;
            }
            document.getElementById("hasil-data").innerHTML = hasil;
          }
        })
        .catch(() => {
          alert("Terjadi kesalahan saat mengambil data.");
          document.getElementById("info").classList.add("hidden");
        });
    }

    function tampilkanFormKoreksi() {
      document.getElementById("form-koreksi").classList.remove("hidden");
    }

    function toggleInput(field) {
      const input = document.getElementById("input-" + field);
      input.classList.toggle("hidden");
    }

    function kirimKoreksi() {
      const perbaikan = {};
      const fields = ["NISN", "NIS", "NAMA", "TEMPAT_LAHIR", "TANGGAL_LAHIR", "NAMA_AYAH", "NAMA_IBU"];
      fields.forEach(field => {
        const input = document.getElementById("input-" + field);
        if (!input.classList.contains("hidden") && input.value.trim() !== "") {
          perbaikan[field] = input.value.trim();
        }
      });

      fetch(`https://script.google.com/macros/s/AKfycbwI0QPppH0PcKsAH_VO0KpuANdp8xsWftjcd1LEReTTb-mE3xMYTS0TsV_LGt1Oh37R/exec`, {
        method: "POST",
        body: JSON.stringify({
          nisn: dataSiswa["NISN"],
          nis: dataSiswa["NIS"],
          nama: dataSiswa["Nama"],
          catatan: document.getElementById("catatan").value,
          perbaikan
        })
      })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          location.reload();
        });
    }

    function dataBenar() {
      fetch(`https://script.google.com/macros/s/AKfycbwI0QPppH0PcKsAH_VO0KpuANdp8xsWftjcd1LEReTTb-mE3xMYTS0TsV_LGt1Oh37R/exec`, {
        method: "POST",
        body: JSON.stringify({
          nisn: dataSiswa["NISN"],
          nis: dataSiswa["NIS"],
          nama: dataSiswa["Nama"]
        })
      })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          location.reload();
        });
    }
  </script>
</body>
</html>
